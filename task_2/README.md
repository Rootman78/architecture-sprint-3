Задание 2. Проектирование микросервисной архитектуры

Как понял из технического задания, наиболее значимые критерии при создании нового приложения это сроки (необходимо сделать MVP продукт) и ограниченность в ресурсах (небольшая компания). В системе не планируется сверх большое количество пользователей (при 10 кратном масштабировании их будет около 1000), но необходимо осуществлять надежную связь. Все решения принимаются исходя из этого.

После анализа монолита было принято решение использовать микросервисы при разработке нового функционала.
Программное решение будет содержать следующие микросервисы:
1. Микросервис управления отоплением
2. Микросервис управления светом
3. Микросервис управления воротами
4. Микросервис управления видеонаблюдением
5. Микросервис подключения устройств умного дома


Пользователь может управлять устройствами при помощи мобильного приложения, либо через web браузер
У мобильного приложения web интерфейса будут одинаковые конечные точки. Поэтому у них будут общий бэк-энд. Различие только во фронтэнд частях. В исходном задании не сказано на чем написан фронтэнд веб интерфейса, поэтому предлагаем оставить его том же технологическом стеке для минимизации доработок.
Про мобильные приложения, если оно было используем тот же технологический стек. Если его не было до этого, то необходимо его разработать, так как без этого невозможно управлять системами находясь вне дома, и без него тяжело продвигать наше программное решение на высококонкурентном рынке. Так как нужен достаточно стандартный функционал, предлагаю для экономии писать кроссплатформенное приложение и использовать React Native. Для экономии, в мобильном приложении будет использоваться только основной функционал, связанный с управлением и мониторингом. Функционал настройки и подключения датчиков будет доступен только через веб приложение.

Так как бэк-энд функционал систем отопления написан на Java, следовательно в компании есть опыт написания на этом языке, и разработчики нужной квалификации, поэтому планируем продолжать использовать этот язык для написания дополнительного функционала микросервисов. 

Для связи с внешними датчиками и реле будим использовать асинхронное взаимодействие, так как предполагаем, что ряд домов будет находится за городом, где возможны более частые проблемы с интернетом, и нам важно чтобы команды отправленные пользователем обязательно отработали. Микросервис видеонаблюдения будет работать синхронно подключаясь к камерам напрямую.

В качестве баз данных, планирую использовать PostgreSQL как и в первоначальном решении.
Предлагаю создать отдельную базу для каждого микросервиса. Это решение дает преимущество при масштабировании системы, а так же при отказоустойчивости. Связей между базами микросервисов не планируется, амортизационная информация будет находится на API Getaway


1. Не планируются большие объемы данных, данные можно разграничить на уровне таблиц
2. Не планируется плотных взаимосвязей между данными, кроме этапов проверки авторизации, следовательно не будет блокировок.
3 Так как данные связанные с авторизацией хранятся в общей базе, нет необходимости в написании дополнительно API для проверки авторизации, между микросервисами.


На диаграмме контейнеров будут отображены следующие контейнеры:
1. Мобильное приложение: Для удобства управления умным домом и мониторинга планируем использовать мобильное приложение. Так как не планируется сложный функционал, предлагаю для экономии писать кроссплатформенное приложение и использовать React Native. Для экономии, в мобильном приложении будет использоваться только основной функционал, связанный с управлением и мониторингом. Функционал настройки и подключения датчиков будет доступен только через веб приложение.
2. Веб приложение: Содержит полный функционал по управлению мониторингу и настройке новых устройств нового дома. 

Решение состоит из системы управления температурой и системы мониторинга температуры, которые подключены к внешним датчикам. Более подробно можно посмотреть диаграмму в файле task_1.puml  

На мой взгляд, текущее решение не имело проблем, пока компания занималась только управлением отопления в домах. В будущем планируется добавить функционал  включения/выключения света, управления автоматическими воротами, удалённого наблюдения за домом, подключения устройств умного дома. В связи с этим я вижу 3 основные проблемы:
1. Надежность нового решения. Если новый функционал будет включен в те же системы, что и отопление,то при возникновении проблем (глобальных ошибок в коде, ошибок в работе серверов) перестанет работать весь функционал. Если мы разобьем функционал на несколько микросервисов по принципу DDD, то при возникновении проблем в функционале определенной доменной области, остальные микросервисы продолжат работу.
2. Удобство разработки и развертывания: При работе с монолитом, будет проблемно большой команде разработчиков решать разные задачи в рамках общего кода монолита. При использовании микросервисов, проще организовать параллельную разработку функционала при помощи разных команд разработчиков
Так же в случае доработок(исправления ошибок) в одной доменной области, мы не сможем автоматически делать обновления не затронув основной функционал. В случае разбивки на микросервисы этих проблем не было бы.
3. Масштабируемость: При увеличении нагрузки на определенные доменные области, мы не сможем их масштабировать не затронув весь монолит. С микросервисами возможно масштабирование отдельных областей.

В связи с этим при расширении функционала имеет смысл  сразу переходить на микросервисы. К функционалу управления отоплением мы добавим микросервисы отвечающие за управление светом, управление воротами, ведение наблюдения, подключения устройств умного дома.   